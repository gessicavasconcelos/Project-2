---
title: "Project 2"
author: "Ashley Frankenfield, Gessica Vasconcelos"
date: "4/3/2020"
output: 
  rmdformats::readthedown:
    html_document:
      number_sections: TRUE
      self_contained: TRUE
      lightbox: TRUE
      gallery: FALSE
      highlight: tango 
      thumbnails: true
      toc_float: TRUE
      use_bookdown: TRUE
      code_folding: hide 
      max-width: 1800px
    pdf_document:
      toc: yes
      toc_depth: '3'
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F, results = 'hide', message = F, echo=F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
```

```{r basicfcn}
# use this function to conveniently load libraries and work smoothly with knitting
# can add quietly=T option to the require() function
# note that using this function requires quotes around the package name, as you would when installing packages.
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
# unload/detact package when done using it 
detach_package = function(pkg, character.only = FALSE) { if(!character.only) { pkg <- deparse(substitute(pkg)) } 
  search_item <- paste("package", pkg,sep = ":") 
  while(search_item %in% search()) { detach(search_item, unload = TRUE, character.only = TRUE) } 
}
```

```{r outlierKD2}
outlierKD2 <- function(df, var, rm=FALSE) { 
    #' Original outlierKD functino by By Klodian Dhana,
    #' https://www.r-bloggers.com/identify-describe-plot-and-remove-the-outliers-from-the-dataset/
    #' Modified to have third argument for removing outliers inwtead of interactive prompt, 
    #' and after removing outlier, original df will not be changed. The function returns the new df, 
    #' which can be saved as original df name if desired.
    #' Check outliers, and option to remove them, save as a new dataframe. 
    #' @param df The dataframe.
    #' @param var The variable in the dataframe to be checked for outliers
    #' @param rm Boolean. Whether to remove outliers or not.
    #' @return The dataframe with outliers replaced by NA if rm==TRUE, or df if nothing changed
    #' @examples
    #' outlierKD2(mydf, height, FALSE)
    #' mydf = outlierKD2(mydf, height, TRUE)
    #' mydfnew = outlierKD2(mydf, height, TRUE)
    dt = df # duplicate the dataframe for potential alteration
    var_name <- eval(substitute(var),eval(dt))
    na1 <- sum(is.na(var_name))
    m1 <- mean(var_name, na.rm = T)
    par(mfrow=c(2, 2), oma=c(0,0,3,0))
    boxplot(var_name, main="With outliers")
    hist(var_name, main="With outliers", xlab=NA, ylab=NA)
    outlier <- boxplot.stats(var_name)$out
    mo <- mean(outlier)
    var_name <- ifelse(var_name %in% outlier, NA, var_name)
    boxplot(var_name, main="Without outliers")
    hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
    title("Outlier Check", outer=TRUE)
    na2 <- sum(is.na(var_name))
    cat("Outliers identified:", na2 - na1, "\n")
    cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "\n")
    cat("Mean of the outliers:", round(mo, 2), "\n")
    m2 <- mean(var_name, na.rm = T)
    cat("Mean without removing outliers:", round(m1, 2), "\n")
    cat("Mean if we remove outliers:", round(m2, 2), "\n")
    
    # response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ")
    # if(response == "y" | response == "yes"){
    if(rm){
        dt[as.character(substitute(var))] <- invisible(var_name)
        #assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
        cat("Outliers successfully removed", "\n")
        return(invisible(dt))
    } else {
        cat("Nothing changed", "\n")
        return(invisible(df))
    }
}
```

```{r loadPkg}
  loadPkg("corrplot")
  loadPkg("dplyr")
  loadPkg("ggplot2")
  loadPkg("tidyverse")
  loadPkg("sqldf")
  loadPkg('tidyr')
```

#Criminal Statistics for DC area
``` {r Load Dataset}
  # read in the CSV file and make it into a data frame
print(getwd())
  require(data.table)
  system.time(df <- fread("Adult_Arrests.csv"))
  df <- data.frame(df)
df <- subset(df, select= -c(2, 7, 8)) #removing CCN and Arrest Number due to them being fictious 
# str(df)
```

```{r Converting to Factors}
df$Race <- as.factor(df$Race)
df$ETHNICITY <- as.factor(df$ETHNICITY)
df$SEX <-as.factor(df$SEX)
df$CATEGORY <- as.factor(df$CATEGORY)
df$DESCRIPTION <-as.factor(df$DESCRIPTION)
# str(df)
```

```{r Counting missing values and removing not relevant variables}
sapply(df, function(x) sum(is.na(x)))
```

```{r Basic Information about Data}
AgeSum <- summary(df$AGE)
YearSum <- summary(df$YEAR)
MonthSum <- summary(df$Month)
Female_Ar <- subset(df, SEX == 3)
Male_Ar <- subset(df, SEX ==2)
Unk_Ar <- subset(df, SEX ==1)
```  

This data set contains information on `r nrow(df)` felony arrests from the District of Columbia between the years 2013-2017. A felony arrest involves the police taking into custody a person that is suspected of having committed a crime. Crimes that are less severe often result in misdemeanor charges, while more serious acts can result in a felony charge. In this data set, both type of charges are included. The crimes recorded here include boating violations, disorderly conduct, arson, homicide and many more. These crimes have resulted in the arrest of `r nrow(Female_Ar)` females, `r nrow(Male_Ar)` were males and `r nrow(Unk_Ar)` of unknown gender orientation. The mean age of those arrested is 34.8 years old. 

```{r Is there any correlation between age and type of crime comitted?}

sex_category <- data.frame(df[c("SEX", "CATEGORY")])
sexcat_Logit <- glm(SEX ~ CATEGORY, data = sex_category, family = "binomial")
summary(sexcat_Logit)
```

By looking at the results from the Logit analysis, we can see that only 5 out of 28 categories are statistically significant. These categories are liquor Law Violations, damage to Property, burglary, offenses against family & children, and arson. As for thee statistically significant variables, category 29 has the lowest p-value suggesting a strong association of the sex of the offender with the probability of comitting arson. The negative coefficient for this predictor suggests that all other variables being equal, the gender is less likely to male passenger is less likely to have survived.


```{r}
hist(df$AGE, # histogram
 col="yellow", # column color
 border="black",
 breaks = 25,
 prob = TRUE, # show densities instead of frequencies
 xlim = c(10,80),
 xlab = "Age",
 main = "Age at which crimes are comitted")
lines(density(df$AGE), # density plot
 lwd = 2, # thickness of line
 col = "blue")
```

The histogram and density lines indicates that the age at which the crimes are comitted in DC seems to follow a bimodal distribution. Most of the crimes are comitted by people with 18 years old. There is a steep decrease on crimes comitted by people with aged between 25 and 42 years old. However, this trend is not sustained and the number crimes increaseases comitted by people with ~ 50 years old increases again. 

```{r Can age be used as a predictor for the type of crime commited}

df1 <- df
levels(df1$CATEGORY) <- c("Narcotics", "Release Violations/Fugitive", "Robbery", 
"Prostitution", "Traffic Violations", "Theft", "Driving While Intoxicated", "Property Crimes", "Disorderly Conduct", "Simple Assault", "Other Crimes","Liquor Law Violations", "Damage to Property", "Aggravated Assault", "Assault on a Police Officer", "Assault with a Dangerous Weapon", "Burglary", "Offenses Against Family & Children", "Vending Violations", "Sex Abuse", "Kidnapping", "Sex Offenses", "Fraud and Financial Crimes", "Weapon Violations", "Theft from Auto", "Homicide", "Motor Vehicle Theft","Gambling","Arson")


ggplot(df1, aes(x=CATEGORY, y=AGE, fill= CATEGORY)) + 
  geom_boxplot(outlier.colour="red", outlier.shape=1,show.legend = FALSE,
                outlier.size=2) + ggtitle("Type of Crime Comitted according to age")

```

```{r}
loadPkg("ggstatsplot")
boxplot(CATEGORY ~ AGE, data=df, main="Ozone reading across months")  

<<<<<<< HEAD
```
=======
```{r Do people commit crime in their neighborhood}
Liv_OutState <- subset(df, DEFENDANT_PSA == 0) # Arrests of People from out-of-state 
Liv_DC <- subset(df, DEFENDANT_PSA > 100) # Arrests of DC Residents 
Home_Crime <- subset(df, DEFENDANT_PSA == OFFENSE_PSA) #The crime was committed in the area that the defendent lives. 

df2 <- Home_Crime 
levels(df2$CATEGORY) <- c("Narcotics", "Release Violations/Fugitive", "Robbery", 
"Prostitution", "Traffic Violations", "Theft", "Driving While Intoxicated", "Property Crimes", "Disorderly Conduct", "Simple Assault", "Other Crimes","Liquor Law Violations", "Damage to Property", "Aggravated Assault", "Assault on a Police Officer", "Assault with a Dangerous Weapon", "Burglary", "Offenses Against Family & Children", "Vending Violations", "Sex Abuse", "Kidnapping", "Sex Offenses", "Fraud and Financial Crimes", "Weapon Violations", "Theft from Auto", "Homicide", "Motor Vehicle Theft","Gambling","Arson")

Violet_Crime <- filter(Home_Crime, CATEGORY == 2|3)
levels(Violet_Crime$CATEGORY)
```


We wanted to examine whether or not people are more likely to commit a felony offense in their own neighborhood. Based on our findings, `r nrow(Home_Crime)` people, or 24%, of those that committed a crime in DC did so in their own neighborhood. We wanted to extend these findings and see what crimes people are more likely to commit closer to home. For our purposes, we have distinguished between violent offenses, white collar crimes and misdemenors. 

Violent Crimes <- Aggravated Assult, Assult on a Police Officer, Assult with a Dangerous Weapon, Sex Offenses, Kidnapping, Sex Abuse, HOmicide, Weapon Violations, Arson


Misdeminor 
```{r crime type}


```

>>>>>>> e7f742310633574e4e2a0f6734ac536c509bfb7d
{r Can age be used and a predictor for kidnepping}

